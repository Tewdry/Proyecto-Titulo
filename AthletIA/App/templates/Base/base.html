{% load static %}

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- ================================
       ESTILOS PRINCIPALES
  ================================= -->
  <link rel="stylesheet" href="{% static 'css/Home/base.css' %}">
  <link rel="stylesheet" href="{% static 'css/Home/chatbot.css' %}">
  <link rel="stylesheet" href="{% static 'css/Home/quickchat.css' %}">

  <!-- BOOTSTRAP + ICONOS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="https://cdn-uicons.flaticon.com/uicons-regular-rounded/css/uicons-regular-rounded.css">
  <link rel="stylesheet" href="https://cdn-uicons.flaticon.com/uicons-solid-rounded/css/uicons-solid-rounded.css">
  <link rel="stylesheet" href="https://cdn-uicons.flaticon.com/uicons-thin-rounded/css/uicons-thin-rounded.css">

  <!-- FULLCALENDAR -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css" rel="stylesheet">

  <!-- PLUGINS JS -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>

  <!-- LANGS FULLCALENDAR -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/locales-all.global.min.js"></script>

  <!-- POPPER + BOOTSTRAP JS -->
  <script src="https://unpkg.com/@popperjs/core@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- SWEETALERT -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- GOOGLE FONTS -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">

  <!-- ICONOS BOOTSTRAP -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  
  <!-- ICONOS IONIC -->
  <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>

  <link rel="icon" type="image/png" href="/media/logo.png">

  {% block head %}{% endblock %}

  <title>
    {% block title %}AthletIA - Entrenamiento y Nutrici贸n{% endblock %}
  </title>
</head>

<body style="
  background-image: url('/media/fondo4.png');
  background-size: cover;
  background-repeat: no-repeat;
  background-attachment: fixed;
  background-position: center;
  min-height: 100vh;
  margin: 0;
">


{% if user.is_authenticated %}

  <!-- =====================================================
      CHATBOT ORIGINAL (no tocado)
  ====================================================== -->
  <div id="chatbot-button" title="Hablar con AthletIA">
    <ion-icon name="chatbubbles-outline"></ion-icon>
  </div>

  <div id="chatbot-modal" class="chatbot-modal shadow-lg">
    <div class="chatbot-header bg-success text-white d-flex justify-content-between align-items-center px-3 py-2">
      <span><strong> AthletIA Coach</strong></span>
      <button id="chatbot-close" class="btn btn-sm btn-light"></button>
    </div>

    <div id="chatbot-body" class="p-3" style="height: 300px; overflow-y: auto;">
      <div class="text-muted text-center">
         Hola {{ user.first_name|default:user.username }}, soy tu asistente AthletIA. 驴En qu茅 puedo ayudarte hoy?
      </div>
    </div>

    <div class="chatbot-input d-flex border-top">
      <input id="chatbot-message" type="text" class="form-control border-0" placeholder="Escribe tu pregunta...">
      <button id="chatbot-send" class="btn btn-success">Enviar</button>
      <button id="reset-chat" class="btn btn-sm btn-outline-danger">Ч Limpiar conversaci贸n</button>
    </div>
  </div>


  <!-- =====================================================
       QUICKCHAT
  ====================================================== -->
  <div id="quickchat-button" title="Mensajes">
      <ion-icon name="chatbubble-ellipses-outline"></ion-icon>
  </div>

  <div id="quickchat-panel">
      <div class="qc-header">
          <span> Chat</span>
          <button id="qc-close"></button>
      </div>

      <div id="qc-conversations" class="qc-body">
          <div class="qc-empty">
              <ion-icon name="chatbubble-ellipses-outline" class="qc-empty-icon"></ion-icon>
              <p>A煤n no tienes mensajes.</p>
          </div>
      </div>
  </div>

{% endif %}



<!-- ================================
    TOASTS
================================ -->
{% if messages %}
  <div id="toast-container">
    {% for message in messages %}
      <div class="toast {{ message.tags }}">{{ message }}</div>
    {% endfor %}
  </div>
  <script>
    setTimeout(() => {
      let c = document.getElementById('toast-container');
      if (c) c.style.display = 'none';
    }, 3000);
  </script>
{% endif %}



<!-- ================================
    NAVBAR ORIGINAL COMPLETA
================================ -->
{% block navbar %}
<nav class="navbar navbar-expand-lg navbar-dark fixed-top py-3" style="background: rgba(0,0,0,0.7); backdrop-filter: blur(10px);">
  <div class="container">

    <a class="navbar-brand d-flex align-items-center gap-2" href="{% url 'base' %}">
      <img src="/media/logo.png" width="40" height="40" alt="AthletIA">
      <span class="fw-bold text-gradient">AthletIA</span>
    </a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse justify-content-between" id="navbarNav">

      <ul class="navbar-nav gap-3 align-items-center">
        <li class="nav-item"><a class="nav-link" href="{% url 'muro' %}">Explorar</a></li>
        <li class="nav-item"><a class="nav-link" href="{% url 'nosotros' %}">Nosotros</a></li>
        <li class="nav-item"><a class="nav-link" href="{% url 'contactanos' %}">Contacto</a></li>

        {% if user.is_authenticated and user.is_staff %}
            <li class="nav-item"><a class="nav-link" href="{% url 'panel_admin' %}">Admin</a></li>
        {% endif %}
      </ul>

      <ul class="navbar-nav align-items-center gap-3">
        {% if user.is_authenticated %}
        <li class="nav-item">
          <a href="{% url 'ia:generar_rutina' %}" class="btn btn-gradient fw-bold text-white px-4 rounded-pill">
            <i class="bi bi-lightning-charge-fill me-1"></i> Generar Rutina
          </a>
        </li>
        {% endif %}
        {% if user.is_authenticated %}
        <li class="nav-item">
          <a href="{% url 'ia:calendario_view' %}" class="btn btn-outline-light fw-semibold px-3 rounded-pill">
            <i class="fa-solid fa-calendar-days me-1"></i> Calendario
          </a>
        </li>
        {% endif %}
        {% if user.is_authenticated %}

          <!--  NOTIFICACIONES -->
          <li class="nav-item dropdown me-2">
            <a class="nav-link position-relative" href="#" id="notificationsDropdown" role="button">
              <i class="bi bi-bell" style="font-size:1.2rem"></i>
              <span id="notifications-badge" class="badge bg-danger rounded-pill ms-1" style="display:none; font-size:0.7rem;">0</span>
            </a>

            <ul class="dropdown-menu dropdown-menu-end p-0 shadow" id="notifications-dropdown" style="width:320px;">
    
                <li class="dropdown-header d-flex justify-content-between align-items-center">
                    <strong>Notificaciones</strong>
                    <button id="mark-all-read" class="btn btn-sm btn-link">Marcar todas</button>
                </li>

                <div id="notifications-list">
                    </div>

                <li class="notifications-footer">
                    <a href="{% url 'notifications_list' %}" id="notifications-see-all">Ver todas</a>
                </li>
            </ul>
          </li>

          <!-- Usuario -->
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" data-bs-toggle="dropdown">
              <ion-icon name="person-circle-outline" style="font-size:1.8rem"></ion-icon>
              <span class="ms-1">{{ user.username }}</span>
            </a>
            <ul class="dropdown-menu dropdown-menu-end">
              <li><a class="dropdown-item" href="{% url 'detalle_perfil' request.user.pk %}">Mi Perfil</a></li>
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item" href="{% url 'ia:dashboard_view' %}">Dashboard</a></li>
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item" href="{% url 'g_Dieta' %}">Consulta Alimentos</a></li>
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item text-danger" href="{% url 'cerrar_Sesion' %}">Cerrar sesi贸n</a></li>
            </ul>
          </li>

        {% else %}
          <li class="nav-item">
            <a href="{% url 'inicio_Sesion' %}" class="btn btn-outline-light">Iniciar Sesi贸n</a>
          </li>
        {% endif %}

      </ul>

    </div>
  </div>
</nav>
{% endblock %}


<!-- ================================
     CONTENIDO
================================ -->
<main class="flex-grow-1 mt-5 pt-4">
  {% block content %}{% endblock %}
</main>


<!-- ================================
     FOOTER
================================ -->
{% block footer %}
<footer class="bg-dark text-white text-center py-3 mt-auto">
  <p class="mb-0">&copy; 2025 AthletIA. Todos los derechos reservados.</p>
</footer>
{% endblock %}



<!-- ================================
     SCRIPTS FINALES
================================ -->
<script src="{% static 'js/chatbot.js' %}"></script>
<script src="{% static 'js/notifications.js' %}"></script>
<script src="{% static 'js/red.js' %}"></script>
<script src="{% static 'js/quickchat.js' %}"></script>
<script src="{% static 'js/dashboard.js' %}"></script>

{% block extra_js %}{% endblock %}

</body>
</html>
